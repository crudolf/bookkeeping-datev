import{d as t,h as e,c as n,a as o,b as r,e as a,t as s,w as u,v as l,F as c,r as i,f as d,o as g,g as p}from"./vendor.7fb938c0.js";!function(t=".",e="__import__"){try{self[e]=new Function("u","return import(u)")}catch(n){const o=new URL(t,location),r=t=>{URL.revokeObjectURL(t.src),t.remove()};self[e]=t=>new Promise(((n,a)=>{const s=new URL(t,o);if(self[e].moduleMap[s])return n(self[e].moduleMap[s]);const u=new Blob([`import * as m from '${s}';`,`${e}.moduleMap['${s}']=m;`],{type:"text/javascript"}),l=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(u),onerror(){a(new Error(`Failed to import: ${t}`)),r(l)},onload(){n(self[e].moduleMap[s]),r(l)}});document.head.appendChild(l)})),self[e].moduleMap={}}}("/bookkeeping-datev/assets/");var h=t({name:"App",data:()=>({currentCSV:null,bookings:[],months:[],currentMonth:null,accounts:[""],currentAccount:null,textSearch:null,status:"upload",sortColumn:"datum",sortOrder:"asc"}),methods:{toggleSort(t){this.sortColumn!=t?(this.sortColumn=t,this.sortOrder="asc"):"asc"==this.sortOrder?this.sortOrder="desc":this.sortOrder="asc"},formatMonth:t=>e(t).format("MMM"),formatDate:t=>e(t).format("DD.MM."),monthsFor(t){var e=[];for(var n in t){var o=t[n];0==e.filter((t=>o.datum.getMonth()==t.getMonth())).length&&e.push(o.datum)}return e},calcSaldo(t){var e=0;for(var n in t){var o=t[n];o.konto==this.currentAccount?e+=o.betrag:e-=o.betrag}return e},currentBookings(){var t=[],e=0,n=this;for(var o in this.bookings){var r=this.bookings[o];this.currentMonth&&r.datum.getMonth()!=this.currentMonth-1||(this.currentAccount&&r.konto!=this.currentAccount&&r.gegenKonto!=this.currentAccount||this.textSearch&&r.text&&-1==r.text.toUpperCase().indexOf(this.textSearch.toUpperCase())||(r.konto==this.currentAccount?e+=r.betrag:e-=r.betrag,r.saldo=e,t.push(r)))}return t=t.sort(((t,e)=>{var o="asc"==n.sortOrder?1:-1;return"datum"==n.sortColumn?(t.datum.getTime()-e.datum.getTime())*o:"betrag"==n.sortColumn?(t.betrag-e.betrag)*o:"konto"==n.sortColumn?t.konto.localeCompare(e.konto)*o:"gegenKonto"==n.sortColumn?t.gegenKonto.localeCompare(e.gegenKonto)*o:(t.datum.getTime()-e.datum.getTime())*o}))},parseCSV(t){var e=this;e.status="parsing";var n=new FileReader,o=[];n.onload=function(){e.currentCSV=function(t,e){e=e||",";for(var n=new RegExp("(\\"+e+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+e+"\\r\\n]*))","gi"),o=[[]],r=null;r=n.exec(t);){var a,s=r[1];s.length&&s!==e&&o.push([]),a=r[2]?r[2].replace(new RegExp('""',"g"),'"'):r[3],o[o.length-1].push(a)}return o}(n.result,";");var t=[];for(var r in e.currentCSV)if(r>2){var a,s=e.currentCSV[r];a=3==s[9].length?new Date(2019,parseInt(s[9].substring(1),10)-1,parseInt(s[9].substring(0,1),10)):new Date(2019,parseInt(s[9].substring(2),10)-1,parseInt(s[9].substring(0,2),10));var u={betrag:"H"==s[1]?parseFloat(s[0].replace(",",".")):-parseFloat(s[0].replace(",",".")),konto:s[6],gegenKonto:s[7],bu:s[8],datum:a,text:s[13]};-1==o.indexOf(u.konto)&&o.push(u.konto),-1==o.indexOf(u.gegenKonto)&&o.push(u.gegenKonto),t.push(u)}e.bookings=t,e.accounts=o,e.accounts.sort(),e.status="ready"},n.readAsBinaryString(t.target.files[0])}},components:{}});const m={key:0},k={key:1},C={key:2},b={class:"tabs"},f={key:0},v=o("th",null," # ",-1),y=a(" Datum "),S={key:0},x={key:0},M={key:1},O=a(" Betrag "),A={key:0},w={key:0},F={key:1},K=a(" Haben "),V={key:0},B={key:0},U={key:1},R=a(" Soll "),D={key:0},L={key:0},j={key:1},E=o("th",null," Buchungstext ",-1),I={key:0},T=o("th",null," Validiert ",-1),$={style:{"text-align":"right"}},_={key:0},H={key:0},P=o("tfoot",null,null,-1);h.render=function(t,e,p,h,q,z){return g(),n(c,null,["upload"==t.status?(g(),n("div",m,[o("input",{id:"csv",type:"file",onChange:e[1]||(e[1]=(...e)=>t.parseCSV&&t.parseCSV(...e))},null,32)])):r("",!0),"parsing"==t.status?(g(),n("div",k," Verarbeite Datei ")):r("",!0),"ready"==t.status?(g(),n("div",C,[a(s(t.bookings.length)+" Buchungen ",1),o("p",null,[u(o("select",{"onUpdate:modelValue":e[2]||(e[2]=e=>t.currentAccount=e)},[(g(!0),n(c,null,i(t.accounts,(t=>(g(),n("option",{key:t},s(t),1)))),128))],512),[[l,t.currentAccount]]),u(o("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=e=>t.textSearch=e)},null,512),[[d,t.textSearch]])]),o("ul",b,[(g(!0),n(c,null,i(t.monthsFor(t.bookings),(e=>(g(),n("li",{key:e,onClick:n=>t.currentMonth=e.getMonth()+1,class:{active:t.currentMonth==e.getMonth()+1}},s(t.formatMonth(e)),11,["onClick"])))),128))]),o("p",null,s(t.currentBookings().length)+" Buchungen ",1),t.currentAccount?(g(),n("p",f," Saldo: "+s(t.calcSaldo(t.currentBookings()).toFixed(2)),1)):r("",!0),a(" "+s(t.sortColumn)+" ",1),o("table",null,[o("tr",null,[v,o("th",{onClick:e[4]||(e[4]=e=>t.toggleSort("datum"))},[y,"datum"==t.sortColumn?(g(),n("span",S,["asc"==t.sortOrder?(g(),n("span",x," ↓ ")):r("",!0),"desc"==t.sortOrder?(g(),n("span",M," ↑ ")):r("",!0)])):r("",!0)]),o("th",{onClick:e[5]||(e[5]=e=>t.toggleSort("betrag"))},[O,"betrag"==t.sortColumn?(g(),n("span",A,["asc"==t.sortOrder?(g(),n("span",w," ↓ ")):r("",!0),"desc"==t.sortOrder?(g(),n("span",F," ↑ ")):r("",!0)])):r("",!0)]),o("th",{onClick:e[6]||(e[6]=e=>t.toggleSort("konto"))},[K,"konto"==t.sortColumn?(g(),n("span",V,["asc"==t.sortOrder?(g(),n("span",B," ↓ ")):r("",!0),"desc"==t.sortOrder?(g(),n("span",U," ↑ ")):r("",!0)])):r("",!0)]),o("th",{onClick:e[7]||(e[7]=e=>t.toggleSort("gegenKonto"))},[R,"gegenKonto"==t.sortColumn?(g(),n("span",D,["asc"==t.sortOrder?(g(),n("span",L," ↓ ")):r("",!0),"desc"==t.sortOrder?(g(),n("span",j," ↑ ")):r("",!0)])):r("",!0)]),E,t.currentAccount?(g(),n("th",I," Saldo ")):r("",!0),T]),(g(!0),n(c,null,i(t.currentBookings(),((e,a)=>(g(),n("tr",{key:a+"-booking"},[o("td",null,[o("small",null,s(a+1),1)]),o("td",null,s(t.formatDate(e.datum)),1),o("td",$,[e.betrag>0?(g(),n("b",_,s(e.betrag.toFixed(2)),1)):r("",!0)]),o("td",{onClick:n=>t.currentAccount=e.konto},s(e.konto),9,["onClick"]),o("td",{onClick:n=>t.currentAccount=e.gegenKonto},s(e.gegenKonto),9,["onClick"]),o("td",null,s(e.text),1),t.currentAccount?(g(),n("td",H,s(e.saldo.toFixed(2)),1)):r("",!0),o("td",{onClick:t=>e.validated=!0},[o("div",{class:{validated:e.validated}},"   ",2)],8,["onClick"])])))),128)),P])])):r("",!0)],64)},p(h).mount("#app");
